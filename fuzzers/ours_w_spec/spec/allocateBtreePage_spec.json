{
  "target": { 
    "function": "allocateBtreePage",
    "fc": "btree_001",
    "category": "B-Tree",
    "subcategory": "Index Management",
    "file": "btree.c",
    "line": 6475,
    "static": true
  },
  "struct_spec": {
    "btree_shared": {
      "pBt": "BtShared*",
      "description": "B-Tree shared structure containing database state"
    },
    "mem_page": {
      "ppPage": "MemPage**",
      "description": "Output pointer to allocated page"
    },
    "page_number": {
      "pPgno": "Pgno*",
      "description": "Output pointer to page number"
    },
    "allocation_params": {
      "nearby": "Pgno",
      "eMode": "u8",
      "description": "Allocation parameters: nearby page and mode"
    }
  },
  "validation_spec": {
    "memory_align": 8,
    "page_number_range": {"min": 1, "max": 4294967295},
    "allocation_modes": ["BTALLOC_ANY", "BTALLOC_EXACT", "BTALLOC_LE"],
    "mode_values": {"BTALLOC_ANY": 0, "BTALLOC_EXACT": 1, "BTALLOC_LE": 2},
    "btree_state": ["mutex_held", "pPage1_valid", "autoVacuum_enabled"],
    "freelist_constraints": {
      "max_pages_on_freelist": "mxPage-1",
      "freelist_corruption_check": "n < mxPage"
    }
  },
  "fc_mapping": {
    "source": "btree.c:6475",
    "rationale": "allocateBtreePage - Critical B-Tree page allocation function",
    "api_level": "internal",
    "complexity": "high",
    "call_frequency": "high"
  },
  "constraints": {
    "max_input_size": 64,
    "min_input_size": 16,
    "endianness": "LE",
    "sqlite_version": "3.51.0",
    "requires_initialization": true,
    "requires_btree_setup": true
  },
  "notes": {
    "preconditions": [
      "sqlite3_initialize() called",
      "Valid BtShared object with mutex held",
      "pPage1 initialized and valid",
      "Database file opened and accessible"
    ],
    "side_effects": [
      "Database pages allocated from freelist or file",
      "Freelist structure modified",
      "Page1 header updated (freelist count)",
      "Memory allocation for MemPage structure"
    ],
    "error_conditions": [
      "SQLITE_CORRUPT_BKPT: Database corruption detected",
      "SQLITE_NOMEM: Out of memory",
      "SQLITE_IOERR: I/O error reading/writing pages",
      "SQLITE_FULL: Database file size limit reached"
    ],
    "fuzzing_strategy": [
      "Test freelist corruption scenarios",
      "Test boundary conditions for page numbers",
      "Test different allocation modes",
      "Test memory pressure conditions",
      "Test concurrent access patterns"
    ],
    "coverage_targets": [
      "Freelist traversal logic",
      "Page allocation from file end",
      "Auto-vacuum pointer map handling", 
      "Error handling paths",
      "Memory allocation failure paths"
    ]
  }
}